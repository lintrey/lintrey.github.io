<!DOCTYPE html>
<html>
<head>
  <title>AR.js 测距 Demo</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.2/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin:0;overflow:hidden;">
  <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
    <a-marker preset="hiro" id="marker">
      <!-- 测量点，会在点击时生成 -->
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>
  <script>
    let points = [];
    let marker = document.querySelector('#marker');
    marker.addEventListener('click', function (evt) {
      // 获取点击在marker上的位置（近似）
      let intersection = evt.detail.intersection;
      if (!intersection) return;
      points.push(intersection.point);

      // 在 marker 上生成一个小球
      let scene = document.querySelector('a-scene');
      let sphere = document.createElement('a-sphere');
      sphere.setAttribute('radius', 0.02);
      sphere.setAttribute('color', 'red');
      sphere.setAttribute('position', intersection.point);
      marker.appendChild(sphere);

      // 两点测距
      if (points.length === 2) {
        let d = Math.sqrt(
          Math.pow(points[0].x - points[1].x, 2) +
          Math.pow(points[0].y - points[1].y, 2) +
          Math.pow(points[0].z - points[1].z, 2)
        );
        alert("两点距离：" + (d * 100).toFixed(2) + "cm");
        points = [];
        // 清空点
        marker.querySelectorAll('a-sphere').forEach(n => n.remove());
      }
    });
  </script>
</body>
</html>
