<!DOCTYPE html>
<html>
<head>
  <title>AR.js 测距 Demo</title>
  <!-- 推荐用官方 CDN -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://ar-js-org.github.io/AR.js/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin:0;overflow:hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-marker preset="hiro" id="marker">
      <!-- 测量点，会在点击时生成 -->
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>
  <script>
    let points = [];
    let marker = document.querySelector('#marker');
    marker.addEventListener('click', function (evt) {
      let intersection = evt.detail.intersection;
      if (!intersection) return;
      points.push(intersection.point);

      // 显示测量点
      let sphere = document.createElement('a-sphere');
      sphere.setAttribute('radius', 0.02);
      sphere.setAttribute('color', 'red');
      sphere.setAttribute('position', intersection.point.x + " " + intersection.point.y + " " + intersection.point.z);
      marker.appendChild(sphere);

      if (points.length === 2) {
        let d = Math.sqrt(
          Math.pow(points[0].x - points[1].x, 2) +
          Math.pow(points[0].y - points[1].y, 2) +
          Math.pow(points[0].z - points[1].z, 2)
        );
        alert("两点距离：" + (d * 100).toFixed(2) + " cm");
        points = [];
        marker.querySelectorAll('a-sphere').forEach(n => n.remove());
      }
    });
  </script>
</body>
</html>
